---
title: "Select"
author: "Cletus Emmanuel"
date: '2022-07-23'
output: powerpoint_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Loading required packages
* tidyverse
* readxl
* magick
* knitr

```{r, echo=FALSE, message=FALSE}
library(tidyverse)
library(readxl)
library(magick)
library(tcltk)
library(knitr)
```

## Load trial file

```{r, echo=FALSE, message=TRUE}
###trial <- read_excel(file.choose(), sheet = "Advancement")

trial <- read_excel("tables/21.GS.C4.AYT.45.IB_Selections.xls", sheet = "Advancement")
###attach(trial)
get_genotypes <- function(){
  return(trial$Genotype)
}


for(i in 1:length(get_genotypes)){
  cat("* ",get_genotypes()[i])
}
```

## Load images
Select a directory and load the images

```{r, echo=FALSE, message=TRUE}
####image_list <- list.files(path = tclvalue(tkchooseDirectory()))
image_list <- list.files(path = "images/photos/")
head(image_list)
```

* Find specific genotype image

```{r, echo=FALSE, message=FALSE}

get_images <- function(genotype){
  list_gen <- c()
  for(i in 1:length(image_list)){
    if(stringr::str_detect(image_list[[i]], regex(genotype)) == TRUE){
        list_gen[[length(list_gen) + 1]] <- image_list[[i]]
    }
  }
  return(list_gen)
}


```

* Render the summary statistics for each genotype in the trial

```{r, echo=FALSE, message=FALSE}

table_chunk <- function(gene){
  df <- trial %>% filter(Genotype == gene)
  genotype_name <- df$Genotype
  MCMDS <- df$MCMDS
  FYLD <- df$FYLD
  DYLD <- df$DYLD
  DM <- df$DM
  SI <- df$SINDEX
  new_df <- data.frame(Trait = c("Genotype","MCMDS", "FYLD", "DYLD", "DM", "SI"), 
                         Value =  c(genotype_name, MCMDS, FYLD, DYLD, DM, SI))
  return(new_df)
}

```

* Load all the images of the selected clones for this trial

```{r, results="asis", echo=FALSE, fig.align='center'}

  genotypes <- get_genotypes()
  i <- 1
  j <- 1
  for(i in 1:length(genotypes)){
    images <- get_images(genotypes[[i]])
    cat("\n")
    cat("## Genotype: ", genotypes[[i]], "\n")
    df <- table_chunk(genotypes[[i]])
    print(kable(df))
    for(j in 1:length(get_images(get_genotypes()[[i]]))){
      image_p <- paste0("images/photos/",images[[j]])
      cat("<center> ![](",image_p,"){width=50%} </center> <br>")
      cat("\n")
    }  
  }

```

