---
title: "Advancement"
author: "Cletus Emmanuel"
date: '2022-07-14'
output: 
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: true
    code_folding: hide
    theme: darkly
    highlight: textmate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Objective

This is a static file that requires getting advanced genotype images and statistic, this can be functional for each accession by editing your clone name in the raw file.

### Libraries needed

Load required packages `tidyverse, readr, stringr, readxl, magick, ggplot2` and set your working directory, in my case, working directory is intact
```{r, echo=TRUE, message=FALSE}
  library(tidyverse)
  library(readr)
  library(readxl)
  library(magick)
  library(ggplot2)
  library(knitr)

  getwd()
```


### Import data
The data we will be working with, in our working directory, and also select the list of genotypes in our data, Advancement sub unit. 


```{r, echo=TRUE, message=TRUE}
  
  raw_data <- read_excel("tables/21.GS.C4.AYT.45.IB_Selections.xls", sheet = "Advancement")
  get_list_of_accession <- function(){
    x <- raw_data$Genotype
    
    return(x)
  }
  
  get_list_of_accession()
  
```

### Select an accession to render
This chunk of code will be edited at intervals to render a different accession
```{r, message=FALSE, echo=TRUE}
  get_selected_genotype <- function(){
    return(get_list_of_accession()[[4]])
  }
  
  get_selected_genotype()
```

### Import images


Get an overview of all the images, we will be using in our code, I am only accessing the first 6 images of over 180 images.
```{r, echo=FALSE, message=TRUE}
  image_list <- list.files(path = "images/photos/", pattern = c(".jpg", ".png"))
  head(image_list)
```
### Select Function
Selec all the images with a particular selected genotype.

```{r, echo=FALSE, message=FALSE}
  genotype_image_list <- function(genotype_name){
    list_gen <- c()
    total_images <- length(image_list)
    i <- 1
    for(i in 1:total_images){
      if(stringr::str_detect(image_list[[i]], regex(genotype_name)) == TRUE){
        ##print(stringr::str_detect(image_list[[i]], regex(genotype_name)))
        list_gen[[length(list_gen) + 1]] <- image_list[[i]]
      }
    }
    return(list_gen)
  }

```


### Render images
This chunk of code will render the images in the list, based on the selected clone

```{r, echo=FALSE}
  image_renderer <- function(image_index){
    genotype_images <- genotype_image_list(get_selected_genotype())
    if(length(genotype_images) > 0){
      image <- image_read(paste0("images/photos/", genotype_images[[image_index]]))
      return(image_ggplot(image))
    }
  }

  image_renderer(1)
  image_renderer(2)
  image_renderer(3)
  image_renderer(4)
  
  if(length(genotype_image_list(get_selected_genotype())) > 4){
    image_renderer(5)
  }
  
```

### Render summary statistic
This chunk generates a table that will render a summary statistic of the particular selected genotype

```{r, echo=FALSE,message=FALSE}
  render_genotype_statistic <- function(){
    
    selected_genotype <- raw_data %>% filter(Genotype == get_selected_genotype())
    genotype <- selected_genotype$Genotype
    MCMDS <- selected_genotype$MCMDS
    FYLD <- selected_genotype$FYLD
    DYLD <- selected_genotype$DYLD
    DM <- selected_genotype$DM
    SI <- selected_genotype$SINDEX
    df <- data.frame(Trait = c("Genotype","MCMDS", "FYLD", "DYLD", "DM", "SI"), 
                         Value =  c(genotype, MCMDS, FYLD, DYLD, DM, SI))
    kable(df)
  }
  render_genotype_statistic()
```